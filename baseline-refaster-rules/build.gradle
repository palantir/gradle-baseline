apply plugin: 'nebula.maven-publish'
apply plugin: 'nebula.source-jar'
apply plugin: 'java-library'
apply from: "${rootDir}/gradle/publish-jar.gradle"

dependencies {
    implementation 'com.google.errorprone:error_prone_refaster'
    implementation 'org.assertj:assertj-core'
    implementation 'org.mockito:mockito-core'

    testCompile 'junit:junit'
    testCompile project(':baseline-refaster-testing')
}

// Do not apply refaster rules
tasks.compileRefaster.enabled = false
tasks.compileJava.onlyIf { project.properties.refasterApply == null }
// Do not apply errorprone rules
tasks.compileJava.options.errorprone.enabled = false

tasks.test.onlyIf {
    boolean lowEnough = JavaVersion.current() < JavaVersion.VERSION_13
    if (!lowEnough) {
        println 'Disabled ' + tasks.test + ' because refaster throws NoSuchFieldErrors on Java13'
    }
    return lowEnough
}
